<%- session_key_name = ActionController::Base.session_options[:key] -%>
<% content_for :javascript do %>

$(document).ready(function(){

	var session_key = '<%= session_key_name %>=';
		session_key += encodeURIComponent('<%= u cookies[session_key_name] %>');

	var user_credentials = 'user_credentials=';
		user_credentials += encodeURIComponent('<%= u cookies['user_credentials'] %>');


	$('#photo_file').uploadify({
		'uploader' : '/flash/uploadify.swf',
		'script' : '/admin/photos/?'+session_key,
		'method' : 'post',
		'fileDataName' : 'photo[file]',
		'scriptData' : {
			'photo[category_id]' : '<%= @category.id if @category %>',
			'authenticity_token' : encodeURIComponent('<%= u form_authenticity_token if protect_against_forgery? %>')
		},
		'multi' : true,
		'auto' : true,
		'cancelImg' : '/images/admin/icons/cancel.png',
		'onComplete' : function(event, queueID, fileObj, response){

			// Add the new photo to the photos div
			$('#photos').prepend(response);
			
			// Hide the note about there being no photos
			$('#photos .note').hide();

		}
	})

});


<% end %>



<% content_for :options do %>

	<!-- We need a multipart form as we're uploading images -->

	<% form_for [:admin, @photo], :html => { :multipart => true } do |f| %>  

		<%= f.file_field :file %>
		<noscript><%= f.submit %></noscript>

	
	<% end %>
<% end %>